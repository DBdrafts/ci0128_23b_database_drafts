@page
@model LoCoMPro.Pages.ModeratePageModel
@{
    ViewData["Title"] = "Registros reportados";
    Layout = "_Layout";
    ViewBag.ShowSearchBar = true;
    ViewBag.ShowLogoLink = true;
    char s = (char)31; // ASCII Control Unit Separator
}
@using Microsoft.AspNetCore.Identity
@using LoCoMPro.Data;
@inject SignInManager<User> SignInManager
@inject UserManager<User> UserManager


<head>
    <link rel="stylesheet" href="~/css/ModeratePage.css" />
    <script src="~/js/interactionsPopUp.js"></script>
    <script src="~/js/productListButton.js"></script>
    <link rel="stylesheet" href="~/css/RateRegister.css" />
    <link rel="stylesheet" href="~/ico/font-awesome-4.7.0/css/font-awesome.css">
</head>

<div class="reported-page-body">
    <div class="reports-section" id="reports-results">
        <!-- Search section title -->
        <div class="results-cont-msg" span id="results-count"></div>

        <!-- Search section header -->
        <nav>
            <ul class="containerListReportColumns">
                <li id="product-col">
                    <div class="textComment">Producto</div>
                </li>
                <li id="user-col">
                    <div class="textComment">Usuario</div>
                </li>
                <li id="date-col">
                    <!-- Button to sort by the date -->
                    @{
                        ViewBag.SortTipe = "#register-date";
                    }
                    @await Html.PartialAsync("_OrderButton", "Fecha")
                </li>
            </ul>
        </nav>

        <ul class="reports-section">
            <!-- Put in all results -->
            @for (int i = 0; i < Model.Reports.Count; i++)
            {
                var report = Model.Reports[i];


                var reportData = $"{report.ReporterId}{s}{report.ContributorId}" +
                    $"{s}{report.ProductName}{s}{report.StoreName}" +
                    $"{s}{report.SubmitionDate.ToShortDateString()}{s}{report.CantonName}" +
                    $"{s}{report.ProvinceName}{s}{report.ReportDate}" +
                    $"{s}{report.ProvinceName}{s}{report.ReportState}";
                     
                <!-- A result block -->
                <li class="result-block register-block-pagination">
                    <!-- Route and data for each result -->
                    @{
                        string contributorName = Model.Users
                            .First(u => u.Id == report.ContributorId).ToString();

                        string reporterName = Model.Users
                            .First(u => u.Id == report.ReporterId).ToString();
                    }
                    <a>
                        <span id="register-product-name" value="@report.ProductName">
                            @report.ProductName
                        </span>
                        <!-- This can be use with the geolocalitation -->
                        <span id="register-reporter" value="@reporterName">
                            @reporterName
                        </span>
                        <span id="register-user" value="@contributorName">
                            @contributorName
                        </span>
                        <span class="short-column" id="register-date" value="@report.SubmitionDate.Date">
                            @report.SubmitionDate.ToShortDateString()
                        </span>
                        @* <span class="short-column align-right" id="register-price" value="@report.Price">
                            ₡ @report.Price.ToString("N0")
                        </span>
                        <span id="register-comment" value="@report.Comment">
                            @Html.DisplayFor(modelItem => report.Comment)
                        </span> *@

                        <div class="text-center align">
                            <button class="open-interactions-button onclick="openInteractionsPopupMod(this)" @* data-register-id="@registerKeys" images-register-id="@registerImages"*@ onclick="openInteractionsPopup(this)">
                                <img src="~/img/MoreIcon.svg" alt="Más opciones">
                            </button>
                        </div>
                    </a>
                </li>
            }
        </ul>

        <!-- Code for interactive pop up -->
        <div class="interactive-popup-section">
            <div class="interactions-popup">
                <div class="interactions-popup-content">
                    <p><b>Fecha:</b> <span id="popup-submitionDate"> </span></p>
                    <p><b>Precio:</b> <span id="popup-price"></span></p>
                    <p><b>Aporde de:</b> <span id="popup-userName"></span></p>
                    <p><b>Comentario:</b> <span id="popup-comment"></span></p>

                    <div class="carousel-section-pop-up">
                        <div class="img-carousel-pop-up">
                        </div>
                    </div>

                    <div class="buttons-container">
                        <button class="interactions-close-button" onclick="closeInteractionsPopup()">Cerrar</button>
                        <button id="saveButton" onclick="saveInteractions()" style="visibility: hidden;">Guardar</button>
                        @if (SignInManager.IsSignedIn(User))
                        {
                            <script>
                                document.getElementById("saveButton").style.visibility = "visible";
                            </script>
                        }

                    </div>
                </div>
            </div>
        </div>
        <div class="product-pagination">
            <!-- Pagination section -->
            @await Html.PartialAsync("_Pagination")
        </div>
            @* <div class="reported-section" id="search-results">
            
                <!-- Individual registers -->
                <div class="result-block">
                    @{
                        string contributorName = Model.Users
                        .First(u => u.Id == register.ContributorId).ToString();
                    }
                    <a>
                        <span id="result-prod">@Html.DisplayFor(modelItem => register.ProductName)</span>
                        <span id="result-usr">@Html.DisplayFor(modelItem => contributorName)</span>
                        <!-- Place for the stars rating of the register -->
                        <span id="result-stars">Stars Place Holder</span>
                        <span id="result-store">@Html.DisplayFor(modelItem => register.StoreName)</span>
                        <span id="result-loc">
                            @Html.DisplayFor(modelItem => register.ProvinciaName),
                            @Html.DisplayFor(modelItem => register.CantonName)
                        </span>
                        <span id="result-price">₡ @Html.DisplayFor(modelItem => register.Price)</span>
                        <span id="result-date">@Html.DisplayFor(modelItem => register.SubmitionDate)</span>
                        <div>
                            @* <form asp-page="ModeratePage" asp-page-handler="MoreInformation"
                        asp-route-id="@register.ContributorId"
                        asp-route-prodName="@register.ProductName"
                        asp-route-storeName="@register.StoreName"
                        asp-route-subDate="@register.SubmitionDate"
                        method="post">
                        <div>
                        <button type="submit" class="button-general"> <img src="/img/MoreIcon.svg"></button>
                        </div>

                        </form>
                            <img src="/img/MoreIcon.svg">
                            <img src="/img/AcceptReportIcon.svg">
                            <img src="/img/InfoIcon.svg">
                        </div>
                    </a>
                </div>

  
            @* </div> *@
    </div>
    <script src="~/js/ProductPage/imageChanger.js"></script>
    <script src="~/js/feedbackMessage.js"></script>
    <script src="~/js/pagination.js"></script>
</div>
<!-- Pagination section -->
