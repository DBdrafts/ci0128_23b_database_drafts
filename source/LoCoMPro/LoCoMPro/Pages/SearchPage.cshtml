@page "~/SearchPage/{pageIndex:int}"
@model LoCoMPro.Pages.SearchPageModel
@{
    ViewData["Title"] = "Busqueda Producto";
    Layout = "_Layout";
    ViewBag.ShowSearchBar = true;
    ViewBag.ShowLogoLink = true;
}

<head>
    <link rel="stylesheet" href="~/css/SearchPage.css" />
</head>

<div>
    <!-- Get the Province and Canton -->
    <div hidden>
        <input id="selectedProvince" value="@Model.Province">
        <input id="selectedCanton" value="@Model.Canton">
    </div>

    <!-- Search filter section -->
    <div class="filter-section" id="filter-section">
        <!-- Search filter title -->
        <h4> Filtros </h4>

        @if (Model.Category.Count() > 1)
        {
            <!-- Filter by category -->
            <h5> Categoría </h5>
            @foreach (var category in Model.Category)
            {
                <div class="filter-line">
                    <input type="checkbox" name="SelectedCategories" value="@category.CategoryName" @(Model.SelectedCategories != null
                   && Model.SelectedCategories.Contains(category.CategoryName) ? "checked" : "") />
                    <label>@Html.DisplayFor(modelItem => category.CategoryName)</label>
                </div>
            }
        }

        <!-- Filter by Province -->
        @if (Model.Provinces.Count() > 1)
        {
            <h5> Provincia </h5>
            @foreach (var province in Model.Provinces)
            {
                <div class="filter-line">
                    <input type="checkbox" name="SelectedProvinces" value="@province.Name" @(Model.SelectedProvinces != null
                   && Model.SelectedProvinces.Contains(province.Name) ? "checked" : "") />
                    <label>@Html.DisplayFor(modelItem => province.Name)</label>
                </div>
            }
        }

        <!-- Filter by Canton -->
        @if (Model.Cantons.Count() > 1)
        {
            <h5> Cantón </h5>
            @foreach (var canton in Model.Cantons)
            {
                <div class="filter-line">
                    <input type="checkbox" name="SelectedCantons" value="@canton.CantonName" @(Model.SelectedCantons != null
                   && Model.SelectedCantons.Contains(canton.CantonName) ? "checked" : "") />
                    <label>@Html.DisplayFor(modelItem => canton.CantonName)</label>
                </div>
            }
        }
    </div>
    
    <!-- Space for button to clean filters -->
    <div class="clear-button-container">
        <!--Secction to add the clear button-->
        <div class="clear-section-button"> 
            <!-- General Button to clean filters-->
            <button class="button-general" id="clear-filters">Limpiar Filtros</button>
        </div>
    </div>  


    <!-- No product found message -->
    <div class="text-center" id="product-not-found" hidden>
        <h2> No se han encontrado resultados de "@Model.SearchString" al buscar por "@Model.SearchType" </h2>
        <img src="~/img/ProductNotFound.svg" alt="Producto no encontrado" />
    </div>

    <!-- Search result section -->
    <div class="search-section">
        <!-- Search section title -->
        <div class="results-cont-msg" span id="results-count"></div>

        <!-- Search section header -->
        <nav>
            <ul class="containerListRegisterColumns">
                <li id="product-col">
                    <div class="textComment">Producto</div>
                </li>
                <li id="brand-col">
                    <div class="textComment">Marca</div>
                </li>
                <li id="model-col">
                    <div class="textComment">Modelo</div>
                </li>
                <li id="store-col">
                    <div class="textComment">Tienda</div>
                </li>
                <li id="province-col">
                    <div class="textComment">Provincia</div>
                </li>
                <li id="canton-col">
                    <div class="textComment">Cantón</div>
                </li>
                <li id="date-col">
                    <div class="textComment">Fecha</div>
                </li>
                <li id="price-col">
                    <!-- Button to sort by the price -->
                    @{
                        ViewBag.SortTipe = "#register-price";
                    }
                    @await Html.PartialAsync("_OrderButton", "Precio")
                </li>
            </ul>
        </nav>

        <!-- Search results section -->
        <ul class="search-section">
            <!-- Put in all results -->
            @foreach (var register in Model.Registers!)
            {
                <!-- A result block -->
                <li class="result-block register-block-pagination">
                    <!-- Route and data for each result -->
                    <a asp-page="./ProductPage"
                       asp-route-pageIndex="1"
                       asp-route-SearchProductName="@register.ProductName"
                       asp-route-SearchStoreName="@register.StoreName"
                       asp-route-SearchCantonName="@register.CantonName"
                       asp-route-SearchProvinceName="@register.ProvinciaName">

                        <span id="register-product-name" value="@register.ProductName">
                            @register.ProductName
                        </span>
                        <span id="register-brand-name" value="@register.Product.Brand">
                            @(string.IsNullOrEmpty(register.Product.Brand) ? "N/A" : register.Product.Brand)
                        </span>
                        <span id="register-model-name" value="@register.Product.Model">
                            @(string.IsNullOrEmpty(register.Product.Model) ? "N/A" : register.Product.Model)
                        </span>
                        <span id="register-store-name" value="@register.StoreName">
                            @register.StoreName
                        </span>

                        <span id="register-province-name" value="@register.ProvinciaName">
                            @register.ProvinciaName
                        </span>
                        <span id="register-canton-name" value="@register.CantonName">
                            @register.CantonName
                        </span>

                        <span id="register-date">
                            @register.SubmitionDate.ToShortDateString()
                        </span>
                        <span class="align-right" id="register-price" value="@register.Price">
                            ₡ @register.Price.ToString("N0")
                        </span>
                        <span id="register-categories" value="@Model.CategoryMap[register.Product.Name]" hidden></span>
                    </a>
                </li>
            }
        </ul>
        <!-- Pagination section -->
        @await Html.PartialAsync("_Pagination")
    </div>
    <script src="~/js/pagination.js"></script>
    <script src="~/js/SearchPage/clearFilters.js"></script>

</div>